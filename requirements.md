# 仮想通貨自動売買Bot（仮想運用フェーズ）要件定義書

> [!NOTE]
> 本システムは **実売買を行わない仮想運用（ペーパートレード）** フェーズのものです。
> 実運用への移行は、1週間〜1ヶ月の検証結果を踏まえて判断します。

---

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | 仮想通貨自動売買Bot（仮想運用） |
| 目的 | 3種類のAIボットによる売買ロジックの有効性検証 |
| 利用者 | 個人（1名） |
| 運用期間 | 1週間〜1ヶ月（検証フェーズ） |
| カテゴリ | 趣味プロジェクト |

---

## 2. 対象銘柄

| 銘柄 | ペア | 選定理由 |
|------|------|----------|
| **BTC** (Bitcoin) | BTC/USDT | 王道。データ豊富で予測モデルを作りやすい |
| **ETH** (Ethereum) | ETH/USDT | BTCとの相関を利用した戦略が立てやすい |
| **SOL** (Solana) | SOL/USDT | 値動きが激しく、ボラティリティ狙いに向く |

---

## 3. 運用パラメータ

| パラメータ | 設定値 |
|-----------|--------|
| 初期仮想資産 | 各ボット 10,000円（合計 30,000円） |
| データ取得頻度 | **5分おき** |
| リポジトリ | **Public**（GitHub Actions無制限） |
| 取引手数料 | 0.1%（Taker手数料相当） |
| スリッページ | 0.05% |
| 合計取引コスト | **0.15%**（片道） |

---

## 4. 3種類のボット戦略定義

3つの異なるリスク特性を持つボットを並行稼働させ、パフォーマンスを比較します。

### 🛡️ Bot A — Defender（ローリスク）

| 項目 | 内容 |
|------|------|
| リスク特性 | ローリスク・ローリターン |
| 方針 | **「負けないこと」を最優先** |
| 動作 | ボラティリティが低い安定局面でのみエントリー。確信度が高い時だけ取引 |
| 主な対象 | BTC中心 |
| AI学習目標 | 予測精度が高い（確信度が高い）時のみエントリー |

### ⚖️ Bot B — Standard（ミドルリスク）

| 項目 | 内容 |
|------|------|
| リスク特性 | ミドルリスク・ミドルリターン |
| 方針 | **「勝率と利益のバランス」を重視** |
| 動作 | テクニカル指標を組み合わせた標準的な判定。平均的なリターンを狙う |
| 主な対象 | BTC, ETH |
| AI学習目標 | 標準的な予測モデルに基づくバランス重視の売買 |

### 🔥 Bot C — Challenger（ハイリスク）

| 項目 | 内容 |
|------|------|
| リスク特性 | ハイリスク・ハイリターン |
| 方針 | **「最大利益の追求」** |
| 動作 | 損失許容範囲を広く取り、急騰・急落の波に積極的に乗る（モメンタム重視） |
| 主な対象 | SOL中心 |
| AI学習目標 | ボラティリティが大きい局面でも積極的にエントリー |

---

## 5. 機能要件

### 5.1 データ収集機能

- **Binance**（国際版）の公開APIから5分おきに最新価格を取得（APIキー不要）
- 取得データをSQLiteに蓄積
- AI学習用に**直近1ヶ月分のヒストリカルデータ**（5分足）を初回に一括取得
- 将来の本番運用時は国内取引所（bitFlyer等）に切り替え

### 5.2 売買判定エンジン（段階的に進化）

#### Phase 1: ルールベース（初期実装）
- **移動平均線クロス** をベースとしたシンプルなロジックで稼働開始
- 各ボットのリスク特性に応じてパラメータ（期間・しきい値）を調整

#### Phase 2: AI化（第2〜3週以降）
- **インプット**: 価格データから算出するテクニカル指標
  - RSI（相対力指数）
  - 移動平均線（SMA/EMA）と乖離率
  - ボリンジャーバンド
  - MACD
  - ボラティリティ指標
- **AIモデル**: LightGBM / Random Forest（決定木ベース）
  - 「5分後の価格が上がるか下がるか」を確率で予測
  - 各ボットごとに異なるしきい値で売買判定
- **学習データ**: Binanceから取得した直近1ヶ月分の10分足ヒストリカルデータ

### 5.3 仮想約定エンジン

- エントリー（買い）判定: AIの予測スコアがしきい値を超えた場合に仮想買い
- エグジット（売り）判定: 利確・損切りライン、またはAI判定による仮想売り
- **約定計算**: 現在価格 × (1 ± 取引コスト0.15%) で実効価格を算出
- 仮想残高のリアルタイム計算・更新

### 5.4 ログ・記録機能

以下の項目を5分ごとに記録:

| フィールド | 説明 |
|-----------|------|
| `timestamp` | 記録日時 (例: 2026-02-17 18:00:00) |
| `bot_name` | ボット名 (Defender / Standard / Challenger) |
| `symbol` | 銘柄 (BTC/USDT 等) |
| `price` | 現在価格 |
| `action` | 判定 (BUY / SELL / HOLD) |
| `quantity` | 取引数量（仮想） |
| `balance` | 仮想残高（円） |
| `position` | 保有量 |
| `profit_loss` | 損益 |
| `ai_confidence` | AI確信度スコア |

### 5.5 LINE Bot 通知機能

| 項目 | 内容 |
|------|------|
| 通知手段 | LINE Messaging API |
| 通知頻度 | **1日1回**（例: 21:00） |
| 通知内容 | 3ボットの日次サマリー |

**通知メッセージ例:**

```
📅 仮想通貨ボット 日次レポート
(2026/02/17 21:00)

🛡️ Bot A (Defender)
・現在資産: 10,050円 (+0.5%)
・本日取引: 2回

⚖️ Bot B (Standard)
・現在資産: 10,200円 (+2.0%)
・本日取引: 5回

🔥 Bot C (Challenger)
・現在資産: 9,800円 (-2.0%)
・本日取引: 12回

💰 合計資産: 30,050円 (前日比 +0.2%)
状態: システム正常稼働中
```

---

## 6. 非機能要件

### 6.1 セキュリティ

| 対策 | 内容 |
|------|------|
| APIキー管理 | 環境変数（`.env`ファイル）で管理。コード内への直書き厳禁 |
| Git管理 | `.gitignore`でAPIキー・設定ファイルを除外 |
| アクセス制限 | 将来的にVPS利用時はSSH鍵認証必須 |
| API権限 | 将来の本番時は「照会」「トレード」のみ。**「出金」権限は付与しない** |
| IP制限 | 本番移行時は取引所側でIP制限（ホワイトリスト）を設定 |

### 6.2 エラーハンドリング

| 対策 | 内容 |
|------|------|
| リトライ | 指数バックオフ方式（1秒→2秒→4秒、最大3回） |
| 異常値フィルタ | 1回で価格が50%以上変動した場合は取引停止 |
| 死活監視 | システム正常稼働の確認を1日1回LINE通知に含める |
| サーキットブレーカー | 仮想資産が初期の20%以上減少で自動停止 |
| ボット間独立 | 1つのボットがエラーでも他2つは影響を受けない（`try-except`分離） |
| 欠損データ処理 | 取得失敗時は「欠損」としてログに記録し、その間は取引なし |

### 6.3 法的・税務対応（将来の拡張性）

| 項目 | 内容 |
|------|------|
| 税制対応 | 2026年度 申告分離課税20.315%に対応した損益計算ログの出力 |
| 損失繰越 | 最大3年間の損失繰越控除に対応するデータ保持 |
| 会計連携 | freee等の会計ソフトへインポート可能な形式（CSV）でデータ保持 |

---

## 7. システム構成

| コンポーネント | 選定ツール |
|--------------|-----------|
| 開発言語 | **Python 3.x** |
| APIライブラリ | **CCXT**（複数取引所を統一インターフェースで操作） |
| AIライブラリ | **LightGBM** / scikit-learn |
| データベース | **SQLite**（軽量・設定不要） |
| データソース | **Binance**（公開API、キー不要） |
| 実行基盤 | **GitHub Actions**（5分おきスケジュール実行・Public無制限） |
| 通知 | **LINE Messaging API** |
| バージョン管理 | **Git / GitHub** |

---

## 8. 運用スケジュール（案）

| 期間 | 内容 |
|------|------|
| **第1週** | データ収集基盤の構築。10分おきの価格取得 → SQLiteへの正常記録を確認 |
| **第2週** | AIモデルの学習。過去データを使った特徴量生成と初期モデル構築 |
| **第3週** | 3ボット並行稼働開始。仮想売買シミュレーション実行 |
| **第4週** | 結果分析。ドローダウン・勝率・リターンを比較し、本番移行の判断 |

---

## 9. 将来的な拡張計画

- ✅ 本番運用への移行（実取引所API接続）
- ✅ VPS（月額約1,000円）への移行でデータ取得頻度を1分に引き上げ
- ✅ AIモデルの差し替え機能（`.pkl` / `.onnx`ファイル対応）
- ✅ Bubble等による管理画面（ダッシュボード）構築
- ✅ freee会計連携による自動帳簿入力
- ✅ 取引所をIP制限付きで本番接続

---

## 10. 注意事項

> [!CAUTION]
> - 本システムは**仮想運用**であり、実際の資金を用いた取引は行いません
> - 本番移行時は、必ず**金融庁登録済みの国内取引所**（bitFlyer, Binance Japan, Coincheck等）を使用してください
> - Bybit等の海外取引所は、2026年現在、日本居住者への制限が厳格化されています
> - 自動売買の結果について、いかなる利益も保証するものではありません

> [!IMPORTANT]
> - 取引所のAPIレートリミット（リクエスト過多制限）を遵守すること
> - 過去データの成績は将来の成績を保証しないことを常に意識すること
